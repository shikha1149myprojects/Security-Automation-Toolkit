#!/bin/bash

# Detect OS type
OS_TYPE=$(uname)

# Set the directory to scan based on OS
if [[ "$OS_TYPE" == "Darwin" ]]; then
    # For macOS, scan the /Applications directory
    BASE_DIR="/Users/shikhamehta/Downloads"

elif [[ "$OS_TYPE" == "Linux" ]]; then
    # For Linux, scan the /home directory
    BASE_DIR="/home"

elif [[ "$OS_TYPE" == "MINGW32_NT"* ]] || [[ "$OS_TYPE" == "MINGW64_NT"* ]]; then
    # For Windows, scan the C:\ drive using Windows Defender
    echo "[*] Windows detected. Running malware scan using Windows Defender..."
    powershell -Command "Start-MpScan -ScanType QuickScan"
    echo "[+] Malware scan completed using Windows Defender."
    exit 0

else
    echo "[!] Unsupported OS: $OS_TYPE"
    exit 1
fi

echo "[*] Running ClamAV scan on $BASE_DIR..."
sudo clamscan -r "$BASE_DIR" > output/malware_scan_report.txt
echo "[+] Malware scan completed. Results saved to output/malware_scan_report.txt"
